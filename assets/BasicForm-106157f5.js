var Pe=Object.defineProperty;var Be=Object.getOwnPropertySymbols;var Ce=Object.prototype.hasOwnProperty,Le=Object.prototype.propertyIsEnumerable;var be=(e,a,s)=>a in e?Pe(e,a,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[a]=s,P=(e,a)=>{for(var s in a||(a={}))Ce.call(a,s)&&be(e,s,a[s]);if(Be)for(var s of Be(a))Le.call(a,s)&&be(e,s,a[s]);return e};var E=(e,a,s)=>new Promise((i,p)=>{var u=d=>{try{f(s.next(d))}catch(m){p(m)}},l=d=>{try{f(s.throw(d))}catch(m){p(m)}},f=d=>d.done?i(d.value):Promise.resolve(d.value).then(u,l);f((s=s.apply(e,a)).next())});import{_ as je}from"./FormItem.vue_vue_type_script_lang-0a88aed3.js";import{_ as ke,b as Se,c as Ne}from"./BasicForm.vue_vue_type_style_index_0_lang-fd8e2ed6.js";import{_ as $e,K as U,L as Z,m as ie,n as re,M as ee,N as K,O as he,J as Me,s as _e,u as De,Q as Ue,R as we,S as fe,c as Oe,U as Ke,f as We}from"./index.js";import{a8 as W,_ as q,a9 as G,aa as _,a0 as ze,ag as He,f as ce,R as z,ad as x,E as ue,a1 as de,ac as oe,aj as ae,u as n,g as Ye,e as Y,w as Q,an as qe,q as Ae,J as Ve,s as Xe,d as Ge,r as Ie,k as J,o as Je,al as Qe,$ as Ze,ab as pe,ae as Te,ak as me,F as xe}from"./vue-7ba4ee8d.js";import{h as et,d as Ee,a as tt}from"./helper-67eda2c0.js";import{M as X,az as nt,ap as st,ag as ot}from"./antd-f3f9d490.js";import{u as rt}from"./uniqBy-819cda2d.js";import{u as at}from"./index-20acfc43.js";function it(e,a,s,i,p,u){const l=W("Button"),f=W("BasicArrow"),d=W("FormItem"),m=W("a-col");return e.showActionButtonGroup?(q(),G(m,ae(x({key:0},e.actionColOpt)),{default:_(()=>[ze("div",{style:He([{width:"100%"},{textAlign:e.actionColOpt.style.textAlign}])},[ce(d,null,{default:_(()=>[z(e.$slots,"resetBefore"),e.showResetButton?(q(),G(l,x({key:0,type:"default",class:"mr-2"},e.getResetBtnOptions,{onClick:e.resetAction}),{default:_(()=>[ue(de(e.getResetBtnOptions.text),1)]),_:1},16,["onClick"])):oe("",!0),z(e.$slots,"submitBefore"),e.showSubmitButton?(q(),G(l,x({key:1,type:"primary",class:"mr-2"},e.getSubmitBtnOptions,{onClick:e.submitAction}),{default:_(()=>[ue(de(e.getSubmitBtnOptions.text),1)]),_:1},16,["onClick"])):oe("",!0),z(e.$slots,"advanceBefore"),e.showAdvancedButton&&!e.hideAdvanceBtn?(q(),G(l,{key:2,type:"link",size:"small",onClick:e.toggleAdvanced},{default:_(()=>[ue(de(e.isAdvanced?e.t("component.form.putAway"):e.t("component.form.unfold"))+" ",1),ce(f,{class:"ml-1",expand:!e.isAdvanced,up:""},null,8,["expand"])]),_:1},8,["onClick"])):oe("",!0),z(e.$slots,"advanceAfter")]),_:3})],4)]),_:3},16)):oe("",!0)}const ct=$e(ke,[["render",it]]);function lt(e,a,s){const i=/^\[(.+)\]$/;if(i.test(e)){const p=e.match(i);if(p&&p[1]){const u=p[1].split(",");return a=Array.isArray(a)?a:[a],u.forEach((l,f)=>{ee(s,l.trim(),a[f])}),!0}}}function ft(e,a,s){const i=/^\{(.+)\}$/;if(i.test(e)){const p=e.match(i);if(p&&p[1]){const u=p[1].split(",");return a=U(a)?a:{},u.forEach(l=>{ee(s,l.trim(),a[l.trim()])}),!0}}}function ut({defaultValueRef:e,getSchema:a,formModel:s,getProps:i}){function p(f){var m,g;if(!U(f))return{};const d={};for(const B of Object.entries(f)){let[,r]=B;const[I]=B;if(!I||Z(r)&&r.length===0||ie(r))continue;const R=n(i).transformDateFunc;U(r)&&(r=R==null?void 0:R(r)),Z(r)&&((m=r[0])!=null&&m.format)&&((g=r[1])!=null&&g.format)&&(r=r.map(M=>R==null?void 0:R(M))),re(r)&&(r===""?r=void 0:r=r.trim()),!lt(I,r,d)&&!ft(I,r,d)&&ee(d,I,r)}return u(d)}function u(f){const d=n(i).fieldMapToTime;if(!d||!Array.isArray(d))return f;for(const[m,[g,B],r="YYYY-MM-DD"]of d){if(!m||!g||!B)continue;if(!f[m]){Reflect.deleteProperty(f,m);continue}const[I,R]=f[m],[M,y]=Array.isArray(r)?r:[r,r];f[g]=K(I).format(M),f[B]=K(R).format(y),Reflect.deleteProperty(f,m)}return f}function l(){const f=n(a),d={};f.forEach(m=>{const{defaultValue:g,defaultValueObj:B}=m,r=Object.keys(B||{});r.length&&r.map(I=>{d[I]=B[I],s[I]===void 0&&(s[I]=B[I])}),he(g)||(d[m.field]=g,s[m.field]===void 0&&(s[m.field]=g))}),e.value=X(d)}return{handleFormValues:p,initDefault:l}}const H=24;function dt({advanceState:e,emit:a,getProps:s,getSchema:i,formModel:p,defaultValueRef:u}){const l=Ye(),{realWidthRef:f,screenEnum:d,screenRef:m}=Me(),g=Y(()=>{if(!e.isAdvanced)return 0;const y=n(s).emptySpan||0;if(_e(y))return y;if(U(y)){const{span:b=0}=y,k=n(m);return y[k.toLowerCase()]||b||0}return 0}),B=De(R,30);Q([()=>n(i),()=>e.isAdvanced,()=>n(f)],()=>{const{showAdvancedButton:y}=n(s);y&&B()},{immediate:!0});function r(y,b=0,k=!1){const j=n(f),C=parseInt(y.md)||parseInt(y.xs)||parseInt(y.sm)||y.span||H,D=parseInt(y.lg)||C,S=parseInt(y.xl)||D,N=parseInt(y.xxl)||S;return j<=d.LG?b+=C:j<d.XL?b+=D:j<d.XXL?b+=S:b+=N,k?(e.hideAdvanceBtn=!1,b<=H*2?(e.hideAdvanceBtn=!0,e.isAdvanced=!0):b>H*2&&b<=H*(n(s).autoAdvancedLine||3)?e.hideAdvanceBtn=!1:e.isLoad||(e.isLoad=!0,e.isAdvanced=!e.isAdvanced),{isAdvanced:e.isAdvanced,itemColSum:b}):b>H*(n(s).alwaysShowLines||1)?{isAdvanced:e.isAdvanced,itemColSum:b}:{isAdvanced:!0,itemColSum:b}}const I=qe({});function R(){var j;let y=0,b=0;const{baseColProps:k={}}=n(s);for(const C of n(i)){const{show:D,colProps:S}=C;let N=!0;if(Ue(D)&&(N=D),ie(D)&&(N=D({schema:C,model:p,field:C.field,values:P(P({},n(u)),p)})),N&&(S||k)){const{itemColSum:t,isAdvanced:o}=r(P(P({},k),S),y);y=t||0,o&&(b=y),I[C.field]=o}}(j=l==null?void 0:l.proxy)==null||j.$forceUpdate(),e.actionSpan=b%H+n(g),r(n(s).actionColOptions||{span:H},y,!0),a("advanced-change")}function M(){e.isAdvanced=!e.isAdvanced}return{handleToggleAdvanced:M,fieldsIsAdvancedMap:I}}function pt(e,a={}){const s=/^\[(.+)\]$/;if(s.test(e)){const i=e.match(s);if(i&&i[1]){const p=i[1].split(",");if(!p.length)return;const u=[];return p.forEach((l,f)=>{ee(u,f,a[l.trim()])}),u.filter(Boolean).length?u:void 0}}}function mt(e,a={}){const s=/^\{(.+)\}$/;if(s.test(e)){const i=e.match(s);if(i&&i[1]){const p=i[1].split(",");if(!p.length)return;const u={};return p.forEach(l=>{ee(u,l.trim(),a[l.trim()])}),Object.values(u).filter(Boolean).length?u:void 0}}}function ht({emit:e,getProps:a,formModel:s,getSchema:i,defaultValueRef:p,formElRef:u,schemaRef:l,handleFormValues:f}){function d(){return E(this,null,function*(){const{resetFunc:t,submitOnReset:o}=n(a);t&&ie(t)&&(yield t()),n(u)&&(Object.keys(s).forEach(c=>{const h=n(i).find($=>$.field===c),v=h==null?void 0:h.defaultValueObj,T=Object.keys(v||{});T.length&&T.map($=>{s[$]=v[$]}),s[c]=At(h,p,c)}),Ae(()=>D()),e("reset",Ve(s)),o&&N())})}const m=()=>n(i).map(t=>[...t.fields||[],t.field]).flat(1).filter(Boolean);function g(t){return E(this,null,function*(){const o=m(),F=".",c=o.filter(v=>String(v).indexOf(F)>=0),h=[];o.forEach(v=>{const T=n(i).find(w=>w.field===v);let $=nt(t,v);const le=Reflect.has(t,v);$=et(T==null?void 0:T.component,$);const{componentProps:te}=T||{};let L=te;typeof te=="function"&&(L=L({formModel:n(s)}));const ne=pt(v,t)||mt(v,t);if(le||ne){const w=ne||$;if(k(v))if(Array.isArray(w)){const A=[];for(const V of w)A.push(V?K(V):null);n(s)[v]=A}else n(s)[v]=w?L!=null&&L.valueFormat?w:K(w):null;else n(s)[v]=w;L!=null&&L.onChange&&(L==null||L.onChange(w)),h.push(v)}else c.forEach(w=>{try{const A=w.split(".").reduce((V,O)=>V[O],t);we(A)&&(n(s)[w]=n(A),h.push(w))}catch(A){we(p.value[w])&&(n(s)[w]=X(n(p.value[w])))}})}),j(h).catch(v=>{})})}function B(t){return E(this,null,function*(){const o=X(n(i));if(!t)return;let F=re(t)?[t]:t;re(t)&&(F=[t]);for(const c of F)r(c,o);l.value=o})}function r(t,o){if(re(t)){const F=o.findIndex(c=>c.field===t);F!==-1&&(delete s[t],o.splice(F,1))}}function I(t,o,F=!1){return E(this,null,function*(){const c=X(n(i)),h=Array.isArray(t)?t.map($=>$.field):[t.field];if(c.find($=>h.includes($.field))){fe("There are schemas that have already been added");return}const v=c.findIndex($=>$.field===o),T=U(t)?[t]:t;!o||v===-1||F?F?c.unshift(...T):c.push(...T):v!==-1&&c.splice(v+1,0,...T),l.value=c,y(t)})}function R(t){return E(this,null,function*(){let o=[];if(U(t)&&o.push(t),Z(t)&&(o=[...t]),!o.every(c=>c.component==="Divider"||Reflect.has(c,"field")&&c.field)){fe("All children of the form Schema array that need to be updated must contain the `field` field");return}l.value=o})}function M(t){return E(this,null,function*(){let o=[];if(U(t)&&o.push(t),Z(t)&&(o=[...t]),!o.every(h=>h.component==="Divider"||Reflect.has(h,"field")&&h.field)){fe("All children of the form Schema array that need to be updated must contain the `field` field");return}const c=[];n(i).forEach(h=>{let v;if(o.forEach(T=>{h.field===T.field&&(v=T)}),v!==void 0&&h.field===v.field){const T=Oe(h,v);c.push(T)}else c.push(h)}),y(c),l.value=rt(c,"field")})}function y(t){let o=[];U(t)&&o.push(t),Z(t)&&(o=[...t]);const F={},c=b();o.forEach(h=>{h.component!="Divider"&&Reflect.has(h,"field")&&h.field&&!he(h.defaultValue)&&(!(h.field in c)||he(c[h.field])||Ke(c[h.field]))&&(F[h.field]=h.defaultValue)}),g(F)}function b(){return n(u)?f(Ve(n(s))):{}}function k(t){return n(i).some(o=>o.field===t?Ee.includes(o.component):!1)}function j(t){return E(this,null,function*(){var o;return(o=n(u))==null?void 0:o.validateFields(t)})}function C(t){return E(this,null,function*(){var F;let o;return t===void 0?o=m():o=t===Array.isArray(t)?t:void 0,yield(F=n(u))==null?void 0:F.validate(o)})}function D(t){return E(this,null,function*(){var o;yield(o=n(u))==null?void 0:o.clearValidate(t)})}function S(t,o){return E(this,null,function*(){var F;yield(F=n(u))==null?void 0:F.scrollToField(t,o)})}function N(t){return E(this,null,function*(){t&&t.preventDefault();const{submitFunc:o}=n(a);if(o&&ie(o)){yield o();return}if(n(u))try{const c=yield C(),h=f(c);e("submit",h)}catch(c){if((c==null?void 0:c.outOfDate)===!1&&(c!=null&&c.errorFields))return;throw new Error(c)}})}return{handleSubmit:N,clearValidate:D,validate:C,validateFields:j,getFieldsValue:b,updateSchema:M,resetSchema:R,appendSchemaByField:I,removeSchemaByField:B,resetFields:d,setFieldsValue:g,scrollToField:S}}function At(e,a,s){let i=X(a.value[s]);return vt(e)?i||"":(!i&&e&&yt(e)&&(i=[0,0]),i)}function yt(e){if(e.component==="Slider"&&e.componentProps&&e.componentProps.range)return!0}function vt(e){return(e==null?void 0:e.component)&&tt.includes(e.component)}function gt(p){return E(this,arguments,function*({getSchema:e,getProps:a,formElRef:s,isInitedDefault:i}){Xe(()=>E(this,null,function*(){if(n(i)||!n(a).autoFocusFirstItem)return;yield Ae();const u=n(e),l=n(s),f=l==null?void 0:l.$el;if(!l||!f||!u||u.length===0||!u[0].component.includes("Input"))return;const m=f.querySelector(".ant-row:first-child input");m&&(m==null||m.focus())}))})}const Ft=Ge({name:"BasicForm",components:{FormItem:je,Form:st,Row:ot,FormAction:ct},props:Se,emits:["advanced-change","reset","submit","register","field-value-change"],setup(e,{emit:a,attrs:s}){const i=Ie({}),p=at(),u=Ie({isAdvanced:!0,hideAdvanceBtn:!1,isLoad:!1,actionSpan:6}),l=J({}),f=J(!1),d=J({}),m=J(null),g=J(null),{prefixCls:B}=We("basic-form"),r=Y(()=>P(P({},e),n(d))),I=Y(()=>[B,{[`${B}--compact`]:n(r).compact}]),R=Y(()=>{const{baseRowStyle:A={},rowProps:V}=n(r);return P({style:A},V)}),M=Y(()=>P(P(P({},s),e),n(r))),y=Y(()=>{const A=n(m)||n(r).schemas;for(const V of A){const{defaultValue:O,component:ye,componentProps:ve,isHandleDateDefaultValue:Re=!0}=V;if(Re&&O&&Ee.includes(ye)){const se=ve?ve.valueFormat:null;if(!Array.isArray(O))V.defaultValue=se?K(O).format(se):K(O);else{const ge=[];O.forEach(Fe=>{ge.push(se?K(Fe).format(se):K(Fe))}),V.defaultValue=ge}}}return n(r).showAdvancedButton?X(A.filter(V=>V.component!=="Divider")):X(A)}),{handleToggleAdvanced:b,fieldsIsAdvancedMap:k}=dt({advanceState:u,emit:a,getProps:r,getSchema:y,formModel:i,defaultValueRef:l}),{handleFormValues:j,initDefault:C}=ut({getProps:r,defaultValueRef:l,getSchema:y,formModel:i});gt({getSchema:y,getProps:r,isInitedDefault:f,formElRef:g});const{handleSubmit:D,setFieldsValue:S,clearValidate:N,validate:t,validateFields:o,getFieldsValue:F,updateSchema:c,resetSchema:h,appendSchemaByField:v,removeSchemaByField:T,resetFields:$,scrollToField:le}=ht({emit:a,getProps:r,formModel:i,getSchema:y,defaultValueRef:l,formElRef:g,schemaRef:m,handleFormValues:j});Ne({resetAction:$,submitAction:D}),Q(()=>n(r).model,()=>{const{model:A}=n(r);A&&S(A)},{immediate:!0}),Q(()=>n(r).schemas,A=>{h(A!=null?A:[])}),Q(()=>y.value,A=>{Ae(()=>{var V;(V=p==null?void 0:p.redoModalHeight)==null||V.call(p)}),!n(f)&&A!=null&&A.length&&(C(),f.value=!0)}),Q(()=>i,De(()=>{n(r).submitOnChange&&D()},300),{deep:!0});function te(A){return E(this,null,function*(){d.value=Oe(n(d)||{},A)})}function L(A,V,O){i[A]=V,a("field-value-change",A,V),O&&O.itemProps&&!O.itemProps.autoLink&&o([A]).catch(ye=>{})}function ne(A){const{autoSubmitOnEnter:V}=n(r);if(V&&A.key==="Enter"&&A.target&&A.target instanceof HTMLElement){const O=A.target;O&&O.tagName&&O.tagName.toUpperCase()=="INPUT"&&D()}}const w={getFieldsValue:F,setFieldsValue:S,resetFields:$,updateSchema:c,resetSchema:h,setProps:te,removeSchemaByField:T,appendSchemaByField:v,clearValidate:N,validateFields:o,validate:t,submit:D,scrollToField:le};return Je(()=>{C(),a("register",w)}),P({getBindValue:M,handleToggleAdvanced:b,handleEnterPress:ne,formModel:i,defaultValueRef:l,advanceState:u,getRow:R,getProps:r,formElRef:g,getSchema:y,formActionType:w,setFormModel:L,getFormClass:I,getFormActionBindProps:Y(()=>P(P({},r.value),u)),fieldsIsAdvancedMap:k},w)}});function Bt(e,a,s,i,p,u){const l=W("FormItem"),f=W("FormAction"),d=W("Row"),m=W("Form");return q(),G(m,x(e.getBindValue,{class:e.getFormClass,ref:"formElRef",model:e.formModel,onKeypress:Qe(e.handleEnterPress,["enter"])}),{default:_(()=>[ce(d,ae(me(e.getRow)),{default:_(()=>[z(e.$slots,"formHeader"),(q(!0),Ze(xe,null,pe(e.getSchema,g=>(q(),G(l,{key:g.field,isAdvanced:e.fieldsIsAdvancedMap[g.field],tableAction:e.tableAction,formActionType:e.formActionType,schema:g,formProps:e.getProps,allDefaultValues:e.defaultValueRef,formModel:e.formModel,setFormModel:e.setFormModel},Te({_:2},[pe(Object.keys(e.$slots),B=>({name:B,fn:_(r=>[z(e.$slots,B,ae(me(r||{})))])}))]),1032,["isAdvanced","tableAction","formActionType","schema","formProps","allDefaultValues","formModel","setFormModel"]))),128)),ce(f,x(e.getFormActionBindProps,{onToggleAdvanced:e.handleToggleAdvanced}),Te({_:2},[pe(["resetBefore","submitBefore","advanceBefore","advanceAfter"],g=>({name:g,fn:_(B=>[z(e.$slots,g,ae(me(B||{})))])}))]),1040,["onToggleAdvanced"]),z(e.$slots,"formFooter")]),_:3},16)]),_:3},16,["class","model","onKeypress"])}const Rt=$e(Ft,[["render",Bt]]);export{Rt as B};
